<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Budget Travel Globe</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; text-align:center; background:#000; color:white; }
  #container { display:inline-block; position:relative; }
  #pickDestination { padding:12px 24px; font-size:18px; background:#2c3e50; color:white; border:none; border-radius:6px; cursor:pointer; margin-bottom:12px; transition: background-color 0.3s; }
  #pickDestination:hover { background:#34495e; }
  #pickDestination:disabled { background:#555; cursor:not-allowed; opacity:0.7; }
  #tooltip { position:absolute; background:rgba(44,62,80,0.95); color:white; padding:8px 16px; border-radius:8px; display:none; font-size:16px; pointer-events:none; transform:translate(-50%,-120%); white-space:nowrap; box-shadow:0 4px 12px rgba(0,0,0,0.5); }
</style>
</head>
<body>

<h1>Pick Your Budget Travel Destination</h1>
<div id="container">
  <button id="pickDestination">Pick My Travel Destination</button>
  <div id="earthContainer" style="width:500px;height:500px;"></div>
  <div id="tooltip"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
(function(){
const destinations = [
  { name:"Hanoi, Vietnam", lat:21.0285, lon:105.8542 },
  { name:"Lisbon, Portugal", lat:38.7169, lon:-9.139 },
  { name:"Budapest, Hungary", lat:47.4979, lon:19.0402 },
  { name:"Krak√≥w, Poland", lat:50.0647, lon:19.945 },
  { name:"Bali, Indonesia", lat:-8.4095, lon:115.1889 },
  { name:"Chiang Mai, Thailand", lat:18.7061, lon:98.9817 },
  { name:"Istanbul, Turkey", lat:41.0082, lon:28.9784 },
  { name:"Prague, Czech Republic", lat:50.0755, lon:14.4378 },
  { name:"Sofia, Bulgaria", lat:42.6977, lon:23.3219 },
  { name:"La Paz, Bolivia", lat:-16.5, lon:-68.15 }
];

const container = document.getElementById('earthContainer');
const tooltip = document.getElementById('tooltip');
const button = document.getElementById('pickDestination');

let scene, camera, renderer, earthGroup, earthMesh, cloudMesh, atmosphereMesh;
let markers = [], selectedMarker = null;
let isSpinning = false;
let spinStartTime = 0;
const SPIN_DURATION = 3000; // 3 seconds
const TOTAL_SPINS = 5; // full rotations
let glowSprite;

init();
animate();

function init(){
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(45, container.clientWidth/container.clientHeight, 0.1, 1000);
  camera.position.z = 3;
  renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  // Stars
  const starGeo = new THREE.BufferGeometry();
  const starCount = 2000;
  const positions = [];
  for(let i = 0; i < starCount; i++){
    positions.push(
      (Math.random() - 0.5) * 200,
      (Math.random() - 0.5) * 200,
      (Math.random() - 0.5) * 200
    );
  }
  starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
  const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.3}));
  scene.add(stars);

  // Lights
  scene.add(new THREE.AmbientLight(0xffffff, 0.4));
  const directional = new THREE.DirectionalLight(0xffffff, 1);
  directional.position.set(5, 3, 5);
  scene.add(directional);

  // Earth group
  earthGroup = new THREE.Group();
  scene.add(earthGroup);

  const loader = new THREE.TextureLoader();

  // --- Updated textures from Wikimedia ---
  const earthGeo = new THREE.SphereGeometry(1, 64, 64);
  const earthMat = new THREE.MeshPhongMaterial({
    map: loader.load('https://upload.wikimedia.org/wikipedia/commons/2/2c/Blue_Marble_2001-2002.jpg'), // diffuse
    bumpMap: loader.load('https://upload.wikimedia.org/wikipedia/commons/5/50/Earthbump4k.jpg'), // bump
    bumpScale: 0.05,
    specularMap: loader.load('https://upload.wikimedia.org/wikipedia/commons/6/63/Earthspec4k.jpg'), // specular
    specular: new THREE.Color('grey')
  });
  earthMesh = new THREE.Mesh(earthGeo, earthMat);
  earthGroup.add(earthMesh);

  // Clouds
  const cloudGeo = new THREE.SphereGeometry(1.01, 64, 64);
  const cloudMat = new THREE.MeshPhongMaterial({
    map: loader.load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png'),
    transparent: true,
    opacity: 0.3
  });
  cloudMesh = new THREE.Mesh(cloudGeo, cloudMat);
  earthGroup.add(cloudMesh);

  // Atmosphere
  const atmGeo = new THREE.SphereGeometry(1.03, 64, 64);
  const atmMat = new THREE.MeshBasicMaterial({
    color: 0x00aaff,
    transparent: true,
    opacity: 0.1,
    side: THREE.BackSide
  });
  atmosphereMesh = new THREE.Mesh(atmGeo, atmMat);
  earthGroup.add(atmosphereMesh);

  // Markers
  destinations.forEach(dest => {
    const geo = new THREE.SphereGeometry(0.025, 8, 8);
    const mat = new THREE.MeshBasicMaterial({color: 0x888888});
    const marker = new THREE.Mesh(geo, mat);
    const pos = latLonToXYZ(dest.lat, dest.lon, 1.02);
    marker.position.set(pos.x, pos.y, pos.z);
    marker.userData = {destination: dest};
    markers.push(marker);
    earthGroup.add(marker);
  });

  // Glow sprite
  const spriteMat = new THREE.SpriteMaterial({
    color: 0xff4444,
    transparent: true,
    opacity: 0.8,
    blending: THREE.AdditiveBlending
  });
  glowSprite = new THREE.Sprite(spriteMat);
  glowSprite.scale.set(0.15,0.15,0.15);
  glowSprite.visible = false;
  scene.add(glowSprite);

  button.addEventListener('click', startSpin);

  window.addEventListener('resize', () => {
    camera.aspect = container.clientWidth/container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
}

function latLonToXYZ(lat, lon, radius) {
  const phi = THREE.MathUtils.degToRad(90 - lat);
  const theta = THREE.MathUtils.degToRad(lon);
  return {
    x: radius * Math.sin(phi) * Math.sin(theta),
    y: radius * Math.cos(phi),
    z: radius * Math.sin(phi) * Math.cos(theta)
  };
}

function startSpin() {
  if(isSpinning) return;
  tooltip.style.display="none";
  glowSprite.visible=false;

  selectedMarker = markers[Math.floor(Math.random()*markers.length)];

  button.disabled = true;
  button.textContent = "Spinning...";
  isSpinning = true;
  spinStartTime = Date.now();
}

function animate() {
  requestAnimationFrame(animate);

  // Rotate clouds
  if(cloudMesh) cloudMesh.rotation.y += 0.0008;

  if(isSpinning){
    const elapsed = Date.now() - spinStartTime;
    const progress = Math.min(elapsed / SPIN_DURATION, 1);
    const eased = easeInOutQuart(progress);

    const destLon = selectedMarker.userData.destination.lon;
    const destLat = selectedMarker.userData.destination.lat;

    const targetRotY = THREE.MathUtils.degToRad(-destLon);
    const targetRotX = THREE.MathUtils.degToRad(destLat * 0.5);

    const totalRotY = TOTAL_SPINS * Math.PI * 2 + targetRotY;
    const totalRotX = targetRotX;

    earthGroup.rotation.y = totalRotY * eased;
    earthGroup.rotation.x = totalRotX * eased;

    if(progress>=1){
      isSpinning=false;
      button.disabled=false;
      button.textContent="Pick My Travel Destination";
      showTooltip();
    }
  }

  // Update markers
  markers.forEach(m=>{
    m.material.color.set((m===selectedMarker && !isSpinning)?0xff4444:0x888888);
  });

  // Glow
  if(selectedMarker && !isSpinning){
    const worldPos = selectedMarker.position.clone().applyMatrix4(earthGroup.matrixWorld).multiplyScalar(1.08);
    glowSprite.position.copy(worldPos);
    const pulse = 0.15 + 0.05 * Math.sin(Date.now()*0.005);
    glowSprite.scale.set(pulse,pulse,pulse);
    glowSprite.visible=true;
    updateTooltipPosition();
  }

  renderer.render(scene,camera);
}

function showTooltip(){
  tooltip.textContent = "Your next budget trip: "+selectedMarker.userData.destination.name;
  tooltip.style.display="block";
  updateTooltipPosition();
}

function updateTooltipPosition(){
  if(!selectedMarker || tooltip.style.display==="none") return;
  const vector = selectedMarker.position.clone().applyMatrix4(earthGroup.matrixWorld);
  vector.project(camera);
  const x = (vector.x*0.5+0.5)*container.clientWidth;
  const y = (-vector.y*0.5+0.5)*container.clientHeight;
  tooltip.style.left=`${x}px`;
  tooltip.style.top=`${y}px`;
}

function easeInOutQuart(t){
  return t<0.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;
}

})();
</script>
</body>
</html>
