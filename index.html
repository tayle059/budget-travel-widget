<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Budget Travel Picker Globe</title>
<style>
  body { 
    margin: 0;
    background: #f0f0f0; 
    text-align: center; 
    font-family: Arial, sans-serif; 
  }
  #container {
    display: inline-block;
    position: relative;
  }
  #pickDestination {
    padding: 12px 24px;
    font-size: 18px;
    background-color: #2c3e50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 12px;
  }
  #resultTooltip {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(44, 62, 80, 0.9);
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    display: none;
    font-size: 16px;
  }
</style>
</head>
<body>

<h1>Pick Your Budget Travel Destination</h1>
<div id="container">
  <button id="pickDestination">Pick My Travel Destination</button>
  <div id="earthContainer" style="width: 400px; height: 400px;"></div>
  <div id="resultTooltip"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
(function() {
  const destinations = [
    { name: "Hanoi, Vietnam", lat: 21.0285, lon: 105.8542 },
    { name: "Lisbon, Portugal", lat: 38.7169, lon: -9.139 },
    { name: "Budapest, Hungary", lat: 47.4979, lon: 19.0402 },
    { name: "KrakÃ³w, Poland", lat: 50.0647, lon: 19.945 },
    { name: "Bali, Indonesia", lat: -8.4095, lon: 115.1889 },
    { name: "Chiang Mai, Thailand", lat: 18.7061, lon: 98.9817 },
    { name: "Istanbul, Turkey", lat: 41.0082, lon: 28.9784 },
    { name: "Prague, Czech Republic", lat: 50.0755, lon: 14.4378 },
    { name: "Sofia, Bulgaria", lat: 42.6977, lon: 23.3219 },
    { name: "La Paz, Bolivia", lat: -16.5, lon: -68.15 }
  ];

  let scene, camera, renderer, earthMesh, markers = [], selectedMarker;
  let spinning = false, targetRotationY = 0, spinSpeed = 0, slowing = false, pulseDir = 1;
  const container = document.getElementById('earthContainer');
  const tooltip = document.getElementById('resultTooltip');

  init();
  animate();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
    camera.position.z = 3;

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const light = new THREE.AmbientLight(0xffffff, 1);
    scene.add(light);

    const textureLoader = new THREE.TextureLoader();
    textureLoader.load(
      'https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg',
      function(texture) {
        const geometry = new THREE.SphereGeometry(1, 64, 64);
        const material = new THREE.MeshPhongMaterial({ map: texture });
        earthMesh = new THREE.Mesh(geometry, material);
        scene.add(earthMesh);

        addAllMarkers();
      }
    );

    document.getElementById('pickDestination').addEventListener('click', () => {
      if (!spinning && earthMesh) {
        const choice = destinations[Math.floor(Math.random() * destinations.length)];
        tooltip.style.display = "none";
        spinToDestination(choice);
      }
    });

    window.addEventListener('resize', onWindowResize);
  }

  function addAllMarkers() {
    destinations.forEach(dest => {
      const geo = new THREE.SphereGeometry(0.015, 8, 8);
      const mat = new THREE.MeshBasicMaterial({ color: 0x888888 });
      const marker = new THREE.Mesh(geo, mat);
      const radius = 1.01;
      const latRad = THREE.MathUtils.degToRad(dest.lat);
      const lonRad = THREE.MathUtils.degToRad(dest.lon);
      marker.position.x = radius * Math.cos(latRad) * Math.cos(lonRad);
      marker.position.y = radius * Math.sin(latRad);
      marker.position.z = -radius * Math.cos(latRad) * Math.sin(lonRad);
      scene.add(marker);
      markers.push(marker);
      marker.userData = { destination: dest };
    });
  }

  function spinToDestination(dest) {
    spinning = true; slowing = false; spinSpeed = 0.3;

    const lonRad = dest.lon * (Math.PI / 180);
    const extraSpins = Math.PI * 4;
    targetRotationY = -lonRad + extraSpins;

    selectedMarker = markers.find(m => m.userData.destination === dest);

    setTimeout(() => slowing = true, 1500);
  }

  function animate() {
    requestAnimationFrame(animate);

    if (spinning && earthMesh) {
      if (!slowing) {
        earthMesh.rotation.y += spinSpeed;
      } else {
        const diff = targetRotationY - earthMesh.rotation.y;
        earthMesh.rotation.y += diff * 0.05;
        camera.position.z = 3 - Math.abs(diff)*0.2; // zoom slightly
        camera.lookAt(scene.position);

        if (Math.abs(diff) < 0.002) {
          spinning = false;
          tooltip.textContent = "Your next budget trip: " + selectedMarker.userData.destination.name;
          tooltip.style.display = "block";
        }
      }
    }

    // Pulse selected marker
    if (selectedMarker) {
      selectedMarker.scale.multiplyScalar(1 + 0.01 * pulseDir);
      if (selectedMarker.scale.x > 1.3 || selectedMarker.scale.x < 0.9) pulseDir *= -1;
      selectedMarker.material.color.set(0xff0000);
    }

    renderer.render(scene, camera);
  }

  function onWindowResize() {
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  }
})();
</script>
